<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta name="format-detection" content="telephone=no"/>
        <meta name="msapplication-tap-highlight" content="no"/>
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <!--meta name="viewport"
              content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height target-densitydpi=device-dpi"/-->
        <title>Hello Beacon!</title>
        <script type="text/javascript">
          var logToDom = function (message) {
              var e = document.createElement('label');
              e.innerText = message;

              var br = document.createElement('br');
              var br2 = document.createElement('br');
              document.body.appendChild(e);
              document.body.appendChild(br);
              document.body.appendChild(br2);

              window.scrollTo(0, window.document.height);
          };

          var delegate = new cordova.plugins.locationManager.Delegate();

          delegate.didDetermineStateForRegion = function (pluginResult) {
              logToDom('[DOM] didDetermineStateForRegion: ' + JSON.stringify(pluginResult));

              cordova.plugins.locationManager.appendToDeviceLog('[DOM] didDetermineStateForRegion: ' + JSON.stringify(pluginResult));
          };

          delegate.didStartMonitoringForRegion = function (pluginResult) {
              console.log('didStartMonitoringForRegion:', pluginResult);

              logToDom('didStartMonitoringForRegion:' + JSON.stringify(pluginResult));
          };

          delegate.didRangeBeaconsInRegion = function (pluginResult) {
              logToDom('[DOM] didRangeBeaconsInRegion: ' + JSON.stringify(pluginResult));
          };

          var uuid = 'EB9AB493-32C2-4E5C-BF67-76E86E338BB9';
          var identifier = 'beaconOnTheMacBooksShelf';
          var minor = 1;
          var major = 1;
          var beaconRegion = new cordova.plugins.locationManager.BeaconRegion(identifier, uuid, major, minor);

          cordova.plugins.locationManager.setDelegate(delegate);

          // required in iOS 8+
          //cordova.plugins.locationManager.requestWhenInUseAuthorization();
          cordova.plugins.locationManager.requestAlwaysAuthorization()
          
          cordova.plugins.locationManager.startMonitoringForRegion(beaconRegion).fail(console.error).done();

          cordova.plugins.locationManager.startRangingBeaconsInRegion(beaconRegion).fail(console.error).done();
        </script>
    </head>
    <body>
        <div id="logbar">
            <p id="log">Scanning for beacons...</p>
        </div>
        <div class="center"></div>
    </body>
</html>